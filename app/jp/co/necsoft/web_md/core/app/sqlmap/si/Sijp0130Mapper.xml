<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis. ORg/dtd/mybatis-3-mapper.dtd">
<mapper namespace="jp.co.necsoft.web_md.core.si.sijp0130.dao.Sijp0130Mapper">
<select id="selectS014eomrS015tgmrS016frmrS017bhmr01" parameterType="jp.co.necsoft.web_md.core.app.dto.si.S014eomrExecute" resultType="jp.co.necsoft.web_md.core.app.dto.si.S014eomrExecuteResult">
<!--
  This element is generated from SIBN0130#execute.
-->
    SELECT 
 INSDD                          AS INSDD
,INSTIME                        AS INSTIME
,DPY_NO                         AS DPYNO
,DPY_KBN                        AS DPYKBN
,S.KAISYA_CD                    AS KAISYACD
,S.JIGYOUBU_CD                  AS JIGYOUBUCD 
,S.TEN_CD                       AS TENCD
,S.BMN_CD                       AS BMNCD
,TORIHIKI_CD                    AS TORIHIKICD
,NHN_YMD                        AS NHNYMD
,HAT_YMD                        AS HATYMD
,NHN_YOTEI_YMD                  AS NHNYOTEIYMD
,RUI_KEIJO_YMD                  AS RUIKEIJOYMD 
,KAKUTEI_YMD                    AS KAKUTEIYMD
,ENTRY_KBN                      AS ENTRYKBN
,ENTRY_PLACE                    AS ENTRYPLACE
,SYORI_STS                      AS SYORISTS
,DISP_SYORI_STS                 AS DISPSYORISTS
,MAE_GENKGK                     AS MAEGENKGK
,ATO_GENKGK                     AS ATOGENKGK
,MAE_BAIKGK                     AS MAEBAIKGK
,ATO_BAIKGK                     AS ATOBAIKGK
,CMN_TANTO_CD                   AS CMNTANTOCD 
 , COALESCE(TS.TEN_NM_R1,' ')   AS TENNMR1
 , COALESCE(BS.BMN_NM_R,' ')    AS BMNNMR
 , COALESCE(RS.TRI_NM_R,' ')    AS TRINMR
 , COALESCE(MS.NM,' ')          AS NM
 , COALESCE(T.HAKKO_DAY,'0')    AS THAKKODAY
 , COALESCE(T.TEN_CD,'0')       AS TTENCD 
 , COALESCE(B.HAKKO_DAY,'0')    AS BHAKKODAY
 , COALESCE(B.BMN_CD,'0')       AS BMNCD
 , COALESCE(R.HAKKO_DAY,'0')    AS RHAKKODAY
 , COALESCE(R.TRI_CD,'0')       AS TRICD
 , COALESCE(M.HAKKO_DAY,'0')    AS MHAKKODAY 
 , COALESCE(M.CD_KBN,'0')       AS CDKBN
 , COALESCE(M.CD,'0')           AS CD
FROM
<if test="dpyKbn == '11'">
        S014EOMR S
</if>
<if test="dpyKbn == '14' 
             or dpyKbn == '19'
             or dpyKbn == '24' 
             or dpyKbn == '29' 
             or dpyKbn == '25'">
    (SELECT 
        INSDD 
       ,INSTIME 
       ,DPY_NO 
       ,DPY_KBN
       ,KAISYA_CD
       ,JIGYOUBU_CD 
       ,TEN_CD 
       ,BMN_CD 
       ,MAIN_TORI_CD   AS TORIHIKI_CD 
       ,NHN_YMD 
       ,HAT_YMD 
       ,NHN_YOTEI_YMD 
       ,RUI_KEIJO_YMD 
       ,KAKUTEI_YMD 
       ,ENTRY_KBN
       ,ENTRY_PLACE 
       ,DISP_SYORI_STS
       ,SYORI_STS 
       ,MAE_GENKGK 
       ,ATO_GENKGK 
       ,MAE_BAIKGK 
       ,ATO_BAIKGK 
       ,CMN_TANTO_CD 
       FROM S015TGMR) S
</if>
<if test="dpyKbn == '31'">
    (SELECT 
         INSDD 
        ,INSTIME 
        ,DPY_NO 
        ,DPY_KBN 
        ,SUBSTR(IN_TENPO_CD,1,2)   AS KAISYA_CD 
        ,SUBSTR(IN_TENPO_CD,3,2)   AS JIGYOUBU_CD 
        ,SUBSTR(IN_TENPO_CD,5,3)   AS TEN_CD 
        ,IN_BMN_CD                 AS BMN_CD 
        ,OUT_TENPO_CD              AS TORIHIKI_CD 
        ,SYUKA_YMD                 AS NHN_YMD 
        ,HAT_YMD 
        ,NHN_YOTEI_YMD 
        ,RUI_KEIJO_YMD 
        ,KAKUTEI_YMD 
        ,ENTRY_KBN 
        ,ENTRY_PLACE 
        ,DISP_SYORI_STS 
        ,SYORI_STS 
        ,MAE_GENKGK 
        ,ATO_GENKGK 
        ,MAE_BAIKGK 
        ,ATO_BAIKGK 
        ,CMN_TANTO_CD 
        FROM S016FRMR)  S
</if>
<if test="dpyKbn == '02' 
             or dpyKbn == '05' 
             or dpyKbn == '09' 
             or dpyKbn == '10'">
    (SELECT 
        INSDD 
        ,INSTIME 
        ,DPY_NO 
        ,DPY_KBN 
        ,KAISYA_CD 
        ,JIGYOUBU_CD 
        ,TEN_CD 
        ,BMN_CD 
        ,'         '   AS TORIHIKI_CD 
        ,KEIJO_YMD     AS NHN_YMD 
        ,HAT_YMD 
        ,NHN_YOTEI_YMD 
        ,RUI_KEIJO_YMD 
        ,KAKUTEI_YMD 
        ,ENTRY_KBN 
        ,ENTRY_PLACE 
        ,DISP_SYORI_STS 
        ,SYORI_STS 
        ,MAE_GENKGK 
        ,ATO_GENKGK 
        ,MAE_BAIKGK 
        ,ATO_BAIKGK 
        ,CMN_TANTO_CD 
        FROM S017BHMR)  S
   </if>

<include refid="Example_From_Clause" />
<include refid="Example_Where_Clause" />
    ORDER BY INSDD,INSTIME,DPY_NO
</select>
<select id="selectCountS014eomrS015tgmrS016frmrS017bhmr02" parameterType="jp.co.necsoft.web_md.core.app.dto.si.S014eomrExecute" resultType="int">
<!--
  This element is generated from SIBN0130#executeCount.
-->
SELECT COUNT(*)
 
FROM

<if test="dpyKbn == '11'">
        S014EOMR S
</if>
<if test="dpyKbn == '14' 
             or dpyKbn == '19'  
             or dpyKbn == '24' 
             or dpyKbn == '29' 
             or dpyKbn == '25' 
             ">
    (SELECT 
        INSDD 
       ,INSTIME 
       ,DPY_NO 
       ,DPY_KBN
       ,KAISYA_CD
       ,JIGYOUBU_CD 
       ,TEN_CD 
       ,BMN_CD 
       ,MAIN_TORI_CD   AS TORIHIKI_CD 
       ,NHN_YMD 
       ,HAT_YMD 
       ,NHN_YOTEI_YMD 
       ,RUI_KEIJO_YMD 
       ,KAKUTEI_YMD 
       ,ENTRY_KBN
       ,ENTRY_PLACE 
       ,DISP_SYORI_STS
       ,SYORI_STS 
       ,MAE_GENKGK 
       ,ATO_GENKGK 
       ,MAE_BAIKGK 
       ,ATO_BAIKGK 
       ,CMN_TANTO_CD 
       FROM S015TGMR) S
</if>
<if test="dpyKbn == '31' 
             ">
    (SELECT 
         INSDD 
        ,INSTIME 
        ,DPY_NO 
        ,DPY_KBN 
        ,SUBSTR(IN_TENPO_CD,1,2)   AS KAISYA_CD 
        ,SUBSTR(IN_TENPO_CD,3,2)   AS JIGYOUBU_CD 
        ,SUBSTR(IN_TENPO_CD,5,3)   AS TEN_CD 
        ,IN_BMN_CD                 AS BMN_CD 
        ,OUT_TENPO_CD              AS TORIHIKI_CD 
        ,SYUKA_YMD                 AS NHN_YMD 
        ,HAT_YMD 
        ,NHN_YOTEI_YMD 
        ,RUI_KEIJO_YMD 
        ,KAKUTEI_YMD 
        ,ENTRY_KBN 
        ,ENTRY_PLACE 
        ,DISP_SYORI_STS 
        ,SYORI_STS 
        ,MAE_GENKGK 
        ,ATO_GENKGK 
        ,MAE_BAIKGK 
        ,ATO_BAIKGK 
        ,CMN_TANTO_CD 
        FROM S016FRMR)  S
</if>
<if test="dpyKbn == '02' 
             or dpyKbn == '05'  
             or dpyKbn == '09' 
             or dpyKbn == '10'">
    (SELECT 
        INSDD 
        ,INSTIME 
        ,DPY_NO 
        ,DPY_KBN 
        ,KAISYA_CD 
        ,JIGYOUBU_CD 
        ,TEN_CD 
        ,BMN_CD 
        ,'         '   AS TORIHIKI_CD 
        ,KEIJO_YMD     AS NHN_YMD 
        ,HAT_YMD 
        ,NHN_YOTEI_YMD 
        ,RUI_KEIJO_YMD 
        ,KAKUTEI_YMD 
        ,ENTRY_KBN 
        ,ENTRY_PLACE 
        ,DISP_SYORI_STS 
        ,SYORI_STS 
        ,MAE_GENKGK 
        ,ATO_GENKGK 
        ,MAE_BAIKGK 
        ,ATO_BAIKGK 
        ,CMN_TANTO_CD 
        FROM S017BHMR)  S
</if>
<include refid="Example_From_Clause" />
<include refid="Example_Where_Clause" />
</select>
<sql id="Example_From_Clause" >
   <!--
      T:M006TENM 店舗マスタ
    -->
     LEFT OUTER JOIN (SELECT MAX(HAKKO_DAY) AS HAKKO_DAY, TEN_CD AS TEN_CD
     FROM M006TENM WHERE HAKKO_DAY <![CDATA[ <= ]]> #{currentDay} 
     GROUP BY TEN_CD)  T
     ON S.KAISYA_CD||S.JIGYOUBU_CD||S.TEN_CD = T.TEN_CD 
     
   <!--
      TS:M006TENM 店舗マスタ
    -->
     LEFT OUTER JOIN (SELECT HAKKO_DAY,TEN_CD,TEN_NM_R1 FROM M006TENM)  TS
     ON T.TEN_CD = TS.TEN_CD
      AND  T.HAKKO_DAY = TS.HAKKO_DAY
   <!--
      B:M003BMNM 部門マスタ
    -->
     LEFT OUTER JOIN (SELECT MAX(HAKKO_DAY) AS HAKKO_DAY, BMN_CD AS BMN_CD
     FROM M003BMNM WHERE HAKKO_DAY <![CDATA[ <= ]]> #{currentDay} 
     GROUP BY BMN_CD)  B
     ON S.BMN_CD = B.BMN_CD
   <!--
      B:M003BMNM 部門マスタ
    -->
     LEFT OUTER JOIN (SELECT HAKKO_DAY,BMN_CD,BMN_NM_R FROM M003BMNM)  BS
     ON B.BMN_CD = BS.BMN_CD
      AND  B.HAKKO_DAY = BS.HAKKO_DAY
    
   <!--
      R:M011TRIM 取引先マスタ
    -->
     LEFT OUTER JOIN (SELECT MAX(HAKKO_DAY) AS HAKKO_DAY, TRI_CD AS TRI_CD
     FROM M011TRIM WHERE HAKKO_DAY <![CDATA[ <= ]]> #{currentDay} 
     GROUP BY TRI_CD)  R
     ON S.TORIHIKI_CD = R.TRI_CD
   <!--
      RS:M011TRIM 取引先マスタ
    -->
     LEFT OUTER JOIN (SELECT HAKKO_DAY,TRI_CD,TRI_NM_R FROM M011TRIM)  RS
     ON R.TRI_CD = RS.TRI_CD
      AND  R.HAKKO_DAY = RS.HAKKO_DAY
   <!--
      M:M017MEIM 名称マスタ
    -->
     LEFT OUTER JOIN (SELECT MAX(HAKKO_DAY) AS HAKKO_DAY, CD_KBN AS CD_KBN, CD AS CD
     FROM M017MEIM WHERE HAKKO_DAY <![CDATA[ <= ]]> #{currentDay} 
      AND  CD_KBN = 'SIR'
     GROUP BY CD_KBN,CD)  M
      ON 'SYORI_STS_KBN_'||S.DISP_SYORI_STS||' ' = M.CD
   <!--
      MS:M017MEIM 名称マスタ
    -->
     LEFT OUTER JOIN (SELECT HAKKO_DAY,CD_KBN,CD,NM FROM M017MEIM)  MS
     ON M.CD_KBN = MS.CD_KBN 
      AND  M.CD = MS.CD
      AND  M.HAKKO_DAY = MS.HAKKO_DAY
</sql>     
<sql id="Example_Where_Clause" >
    WHERE 
     S.KAISYA_CD = #{kaisyaCd}
    
      AND  S.JIGYOUBU_CD = #{jigyobuCd}
    
    <if test="tenCd != null  and  tenCd != ''" >
         AND  S.TEN_CD = #{tenCd}
    </if>
    
     AND  DPY_KBN = #{dpyKbn}
    
    <if test="dpyNo != null  and  dpyNo != ''" >
         AND  DPY_NO = #{dpyNo}
    </if>
    <if test="bmnCd != null  and  bmnCd != ''" >
         AND  S.BMN_CD = #{jigyobuCd} || #{bmnCd}
    </if>

    <if test="torihikiCd != null  and  torihikiCd != ''" >
        <choose>
            <when test="dpyKbn == '11'">
                 AND  SUBSTR(TORIHIKI_CD, 1, 6)  = SUBSTR(#{torihikiCd}, 1, 6) <!-- java: 0,6; sql: 1,6  -->
            </when>
            <when test="dpyKbn == '14'  
                          or dpyKbn == '19'  
                          or dpyKbn == '24' 
                          or dpyKbn == '29' 
                          or dpyKbn == '25' 
                          ">
                 AND  SUBSTR(TORIHIKI_CD, 1, 6) = SUBSTR(#{torihikiCd}, 1, 6) <!-- java: 0,6; sql: 1,6  -->
            </when>
            <when test="dpyKbn == '31' 
                              ">
                 AND  TORIHIKI_CD = #{torihikiCd}
            </when> 
            <otherwise>
            </otherwise>
        </choose>
    </if>
    <if test="nhmYmdSt != null  and  nhmYmdSt != ''" >
         AND  NHN_YMD <![CDATA[ >= ]]> #{nhmYmdSt}
    </if>
    <if test="nhmYmdEd != null  and  nhmYmdEd != ''" >
         AND  NHN_YMD <![CDATA[ <= ]]> #{nhmYmdEd}
    </if>
    <if test="hatYmdSt != null  and  hatYmdSt != ''" >
         AND  HAT_YMD <![CDATA[ >= ]]> #{hatYmdSt}
    </if>
    <if test="hatYmdEd != null  and  hatYmdEd != ''" >
         AND  HAT_YMD <![CDATA[ <= ]]> #{hatYmdEd}
    </if>
    <if test="nhnYoteiYmdSt != null  and  nhnYoteiYmdSt != ''" >
         AND  NHN_YOTEI_YMD <![CDATA[ >= ]]> #{nhnYoteiYmdSt}
    </if>
    <if test="nhnYoteiYmdEd != null  and  nhnYoteiYmdEd != ''" >
         AND  NHN_YOTEI_YMD <![CDATA[ <= ]]> #{nhnYoteiYmdEd}
    </if>
    <if test="ruiKejoYmdSt != null  and  ruiKejoYmdSt != ''" >
         AND  RUI_KEIJO_YMD <![CDATA[ >= ]]> #{ruiKejoYmdSt}
    </if>
    <if test="ruiKejoYmdEd != null  and  ruiKejoYmdEd != ''" >
         AND  RUI_KEIJO_YMD <![CDATA[ <= ]]> #{ruiKejoYmdEd}
    </if>
    <if test="entryKbn != null  and  entryKbn != ''" >
        <choose>
            <when test="likeFlag == 1">
                 AND  ENTRY_KBN LIKE #{entryKbn}||'%' <!-- java: 0,1; sql: 1,1  -->
            </when>
            <otherwise>
                 AND  ENTRY_KBN = #{entryKbn}
            </otherwise>
        </choose>
    </if>
    <if test="entryPlace != null  and  entryPlace != ''" >
         AND  ENTRY_PLACE = #{entryPlace}
    </if>
    <if test="kakuteiYmdSt != null  and  kakuteiYmdSt != ''" >
         AND  KAKUTEI_YMD <![CDATA[ >= ]]> #{kakuteiYmdSt}
    </if>
    <if test="kakuteiYmdEd != null  and  kakuteiYmdEd != ''">
	AND KAKUTEI_YMD <![CDATA[ <= ]]> #{kakuteiYmdEd}
    </if>
    <if test="cmnTantoCd != null  and  cmnTantoCd != ''" >
         AND  CMN_TANTO_CD = #{cmnTantoCd}
    </if>
    <if test="syoriSts != null  and  syoriSts != ''" >
         AND  SYORI_STS = #{syoriSts}
    </if>
</sql>
</mapper>
